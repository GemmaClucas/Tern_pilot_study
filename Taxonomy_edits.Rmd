---
title: "Taxonomy_edits"
author: "Gemma Clucas"
date: "6/15/2020"
output:github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(qiime2R)
library(stringr)
```

### Read in qiime taxonomy artifact

```{r}
tax <- read_qza("/Users/gemmaclucas/Dropbox/Diets_from_poop/2019_terns_puffins_fecal_data_analysis/MiFish/final_taxonomy_superblast/superblast_taxonomy.qza")
```

### Make edits to the taxonomy strings

The edits I am making are, in this order:  
1. Remove the entire taxonomy string except the species name (the base R way to do this would be ```(".*;", "", tax$data$Taxon)```).  
2. Group all river herring into *Alosa sp.*  
3. Group *Clupea pallasi* (Pacific herring) into *Clupea harengus* (Atlantic herring).  
4. Change *Sardinops melanostictus* (South American pilchard) to *Clupea harengus* (Atlantic herring).  
5. Change *Etheostoma parvipinne* to *Etheostomatinae*.  
6. Change *Scomber japonicus* to *Scomber colias* (Atlantic chub mackerel).  
7. Group all *Ammodytes* sequences to *Ammodytes sp*.  

Note that a useful function for checking whether changes have worked is ```str_detect()``` e.g. ```tax$data$Taxon %>% str_detect("Sardinops melanostictus")``` shows where it is in the dataframe.

```{r}
tax$data$Taxon <- tax$data$Taxon %>% 
  str_replace_all(".*;", "") %>% 
  str_replace_all("Alosa .*", "Alosa sp.") %>% 
  str_replace("Clupea pallasi", "Clupea harengus") %>% 
  str_replace("Sardinops melanostictus", "Clupea harengus") %>% 
  str_replace("Etheostoma parvipinne", "Etheostomatinae") %>% 
  str_replace("Scomber japonicus", "Scomber colias") %>% 
  str_replace_all("Ammodytes .*", "Ammodytes sp.")

```

### Export back to Qiime artefact
